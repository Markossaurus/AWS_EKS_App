pipeline{
    agent any
    stages {
          stage("checkout"){
              steps{
                checkout([$class:'GitSCM', branches:[[name:'**']], extensions:[], userRemoteConfigs: [[credentialsId: 'edd5b572-22c2-43c1-a50b-991127524391', name:'origin', refspec:"+refs/pull/*:refs/remotes/origin/pr/*", url:'git@github.com:Markossaurus/AWS_EKS_App.git']]])
              }
          }
          stage("build and push images"){

             input{
                 message "Insert dockerhub username: "
                 parameters {
                    string(name: 'DHUSER', defaultValue: '', description: 'repo name')
                  }
             }
             
             steps{
                echo "building webserver1 image"
                sh """
                    docker build -t ${DHUSER}/webserver1:latest NginxCostum1/.
                """

                echo "building webserver2 images"
                sh """
                    docker build -t ${DHUSER}/webserver2:latest NginxCostum2/.
                """

                echo "building haproxy image"
                sh """
                    docker build -t ${DHUSER}/haproxy:latest HAProxyImage/.
                """

                echo "pushing image webserver 1 to dockherhub"
                sh 'docker push ${DHUSER}/webserver1:latest '

                echo "pushing image webserver 2 to dockherhub"
                sh 'docker push ${DHUSER}/webserver2:latest '

                echo "pushing image haproxy to dockherhub"
                sh "sh docker push ${DHUSER}/haproxy:latest"
             } 
         }
    }
}
/* 
         stage("deploy eks cluster"){
             
             steps{
                echo "deploying cluster"
                dir("terraform") {
                    sh "terraform plan"
                }
             } 
         }
         stage("create kubectl"){
              steps{
                echo "creating kubectl"
                sh "aws eks --region eu-central-1 update-kubeconfig --name haproxy"
                }
            }
    }
         
}
  */

  



