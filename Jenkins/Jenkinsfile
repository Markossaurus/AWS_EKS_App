pipeline{
    agent any
    parameters {
        booleanParam(name: 'Refresh',
                    defaultValue: false,
                    description: 'Read Jenkisfile and exit.')
        }
    
    stages {
        stage("Read Jenkisfile") {
            when {
                expression { return params.Refresh == true }
            }
            steps {
                echo("stop")
            }
        }
    stage('Run Jenkinsfile') {
        when{
            expression { return params.Refresh == false }
        }
    stages {
          stage("checkout"){
              steps{
                checkout([$class:'GitSCM', branches:[[name:'**']], extensions:[], userRemoteConfigs: [[credentialsId: 'edd5b572-22c2-43c1-a50b-991127524391', name:'origin', refspec:"+refs/pull/*:refs/remotes/origin/pr/*", url:'git@github.com:Markossaurus/AWS_EKS_App.git']]])
              }
          }
          stage("build"){
             
             steps{
                echo "building image"
                sh """
                    docker build -t test .
                """
             } 
         }
         stage("run"){
             
              steps{
                  sh """
                    docker run --rm test
                """
                    }
                }
            }
        }   
    }
  
}


